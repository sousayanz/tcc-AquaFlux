<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <script type="module" src="javascript/dados.js"></script>
    <noscript>
     <style>
     body { display: none; }
     </style>
     <meta http-equiv="refresh" content="0;url=/index.html">
    </noscript>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AquaFlux - Gr√°ficos e Dados</title>
    <link rel="stylesheet" href="css/dados.css">
    <link rel="icon" type="image/x-icon" href="img/logo.ico">
</head>
<body>
    <!-- Header com navega√ß√£o -->
    <header class="page-header">
        <div class="header-content">
            <div class="nav-section">
                <button class="back-btn" id="backBtn">
                    <span>‚Üê</span> Voltar ao Dashboard
                </button>
                <h1>üìà Gr√°ficos e Dados</h1>
                <!-- Adicionei um local para exibir o nome do usu√°rio -->
                <div class="user-info">
                    <span id="user-name"></span>
                </div>
            </div>
            <div class="controls-section">
                <select id="deviceFilter" class="filter-select">
                    <option value="all">Todos os Dispositivos</option>
                </select>
                <select id="periodFilter" class="filter-select">
                    <option value="today">Hoje</option>
                    <option value="week">Esta Semana</option>
                    <option value="month">Este M√™s</option>
                    <option value="custom">Per√≠odo Personalizado</option>
                </select>
                <button class="export-btn" id="exportBtn">üìä Exportar Dados</button>
                <button class="logout-btn" id="logoutBtn">Sair</button>
            </div>
        </div>
    </header>

    <main class="main-content">
        <!-- Estat√≠sticas Resumo -->
        <section class="stats-overview">
            <div class="stats-grid">
                <div class="stat-card primary">
                    <div class="stat-icon">üîÑ</div>
                    <div class="stat-content">
                        <div class="stat-value" id="totalActivationsMonth">0</div>
                        <div class="stat-label">Ativa√ß√µes do M√™s</div>
                        <div class="stat-change" id="monthChange">+0%</div>
                    </div>
                </div>
                
                <div class="stat-card success">
                    <div class="stat-icon">üìÖ</div>
                    <div class="stat-content">
                        <div class="stat-value" id="activationsToday">0</div>
                        <div class="stat-label">Ativa√ß√µes Hoje</div>
                        <div class="stat-change" id="todayChange">+0</div>
                    </div>
                </div>
                
                <div class="stat-card warning">
                    <div class="stat-icon">‚è±Ô∏è</div>
                    <div class="stat-content">
                        <div class="stat-value" id="timeTodayMinutes">0min</div>
                        <div class="stat-label">Tempo Hoje</div>
                        <div class="stat-change" id="timeChange">+0min</div>
                    </div>
                </div>
                
                <div class="stat-card info">
                    <div class="stat-icon">üìä</div>
                    <div class="stat-content">
                        <div class="stat-value" id="timeWeekHours">0h</div>
                        <div class="stat-label">Tempo da Semana</div>
                        <div class="stat-change" id="weekTimeChange">+0h</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Se√ß√£o de Consumo de √Ågua -->
        <section class="water-consumption-section">
            <h2>üíß Estimativa de Consumo de √Ågua</h2>
            <div class="consumption-grid">
                <div class="consumption-card">
                    <h3>Consumo Di√°rio</h3>
                    <div class="consumption-value">
                        <span id="dailyWaterConsumption">0L</span>
                        <small>Estimativa baseada no tempo de irriga√ß√£o</small>
                    </div>
                    <div class="consumption-chart" id="dailyConsumptionChart">
                        <!-- Gr√°fico simples ser√° gerado aqui -->
                    </div>
                </div>
                
                <div class="consumption-card">
                    <h3>Consumo Semanal</h3>
                    <div class="consumption-value">
                        <span id="weeklyWaterConsumption">0L</span>
                        <small>√öltimos 7 dias</small>
                    </div>
                    <div class="consumption-breakdown">
                        <div class="breakdown-item">
                            <span class="breakdown-label">Irriga√ß√£o Autom√°tica:</span>
                            <span class="breakdown-value" id="autoConsumption">0L</span>
                        </div>
                        <div class="breakdown-item">
                            <span class="breakdown-label">Irriga√ß√£o Manual:</span>
                            <span class="breakdown-value" id="manualConsumption">0L</span>
                        </div>
                    </div>
                </div>
                
                <div class="consumption-card">
                    <h3>Consumo Mensal</h3>
                    <div class="consumption-value">
                        <span id="monthlyWaterConsumption">0L</span>
                        <small>Este m√™s</small>
                    </div>
                    <div class="cost-estimate">
                        <p>Estimativa de Custo:</p>
                        <span class="cost-value" id="estimatedCost">R$ 0,00</span>
                        <small>Baseado em R$ 3,50/m¬≥</small>
                    </div>
                </div>
            </div>
        </section>

       <!-- Gr√°fico de Ativa√ß√µes -->
    <div class="chart-container">
        <h3>üìä Ativa√ß√µes por Per√≠odo</h3>
        <div class="chart-controls">
            <button class="chart-period-btn active" data-period="7d">7 Dias</button>
            <button class="chart-period-btn" data-period="30d">30 Dias</button>
            <button class="chart-period-btn" data-period="90d">90 Dias</button>
        </div>
        <div class="simple-chart" style="position: relative; height: 300px;">
            <canvas id="activationsChart"></canvas>
        </div>
    </div>

    <!-- Gr√°fico de Tempo de Uso -->
    <div class="chart-container">
        <h3>‚è±Ô∏è Tempo de Irriga√ß√£o Di√°rio</h3>
        <div class="time-chart" style="position: relative; height: 300px;">
            <canvas id="timeChart"></canvas>
        </div>
        <div class="chart-legend">
            <div class="legend-item">
                <span class="legend-color auto"></span> Irriga√ß√£o Autom√°tica
            </div>
            <div class="legend-item">
                <span class="legend-color manual"></span> Irriga√ß√£o Manual
            </div>
        </div>
    </div>

    <!-- Gr√°fico de Distribui√ß√£o por Hor√°rio -->
    <div class="chart-container">
        <h3>üïê Distribui√ß√£o por Hor√°rio</h3>
        <div class="hourly-distribution" style="position: relative; height: 300px;">
            <canvas id="hourlyChart"></canvas>
        </div>
    </div>

    <!-- Gr√°fico de Efici√™ncia Semanal -->
    <div class="chart-container">
        <h3>üìà Efici√™ncia Semanal</h3>
        <div class="efficiency-chart" style="position: relative; height: 300px;">
            <canvas id="efficiencyChart"></canvas>
        </div>
        <div class="efficiency-metrics">
            <div class="metric">
                <span class="metric-label">Taxa de Sucesso:</span>
                <span class="metric-value" id="successRate">98%</span>
            </div>
            <div class="metric">
                <span class="metric-label">Uptime:</span>
                <span class="metric-value" id="uptime">99.2%</span>
            </div>
        </div>
    </div>


        <!-- Se√ß√£o de Hist√≥rico Detalhado -->
        <section class="history-section">
            <h2>üìã Hist√≥rico Detalhado</h2>
            <div class="history-controls">
                <div class="search-box">
                    <input type="text" id="searchHistory" placeholder="Buscar no hist√≥rico...">
                    <button class="search-btn">üîç</button>
                </div>
                <div class="history-filters">
                    <select id="actionFilter">
                        <option value="all">Todas as A√ß√µes</option>
                        <option value="auto">Irriga√ß√£o Autom√°tica</option>
                        <option value="manual">Irriga√ß√£o Manual</option>
                        <option value="schedule">Agendamento</option>
                        <option value="config">Configura√ß√£o</option>
                    </select>
                    <input type="date" id="dateFilter">
                </div>
            </div>
            
            <div class="history-table-container">
                <table class="history-table" id="historyTable">
                    <thead>
                        <tr>
                            <th>Data/Hora</th>
                            <th>Dispositivo</th>
                            <th>A√ß√£o</th>
                            <th>Dura√ß√£o</th>
                            <th>Consumo Est.</th>
                            <th>Origem</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="historyTableBody">
                        <!-- Dados ser√£o carregados dinamicamente -->
                    </tbody>
                </table>
            </div>
            
            <div class="pagination" id="historyPagination">
                <!-- Pagina√ß√£o ser√° gerada dinamicamente -->
            </div>
        </section>

        <!-- Se√ß√£o de Relat√≥rios -->
        <section class="reports-section">
            <h2>üìÑ Relat√≥rios</h2>
            <div class="reports-grid">
                <div class="report-card">
                    <h3>üìà Relat√≥rio Mensal</h3>
                    <p>An√°lise completa do uso mensal com gr√°ficos e estat√≠sticas detalhadas.</p>
                    <button class="generate-report-btn" data-type="monthly">
                        üìÑ Gerar Relat√≥rio
                    </button>
                </div>
                
                <div class="report-card">
                    <h3>üí∞ Relat√≥rio de Custos</h3>
                    <p>Estimativa de custos de √°gua e an√°lise de economia.</p>
                    <button class="generate-report-btn" data-type="costs">
                        üí∞ Gerar Relat√≥rio
                    </button>
                </div>
                
                <div class="report-card">
                    <h3>üèÜ Relat√≥rio de Performance</h3>
                    <p>An√°lise de efici√™ncia do sistema e recomenda√ß√µes.</p>
                    <button class="generate-report-btn" data-type="performance">
                        üèÜ Gerar Relat√≥rio
                    </button>
                </div>
                
                <div class="report-card">
                    <h3>üìä Relat√≥rio Customizado</h3>
                    <p>Configure seu pr√≥prio relat√≥rio com m√©tricas personalizadas.</p>
                    <button class="generate-report-btn" data-type="custom">
                        ‚öôÔ∏è Configurar
                    </button>
                </div>
            </div>
        </section>
    </main>

    <!-- Modais (sem altera√ß√£o importante) -->
    <div class="modal-overlay" id="customPeriodModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üìÖ Per√≠odo Personalizado</h3>
                <button class="close-modal" id="closeCustomPeriod">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="startDate">Data de In√≠cio:</label>
                    <input type="date" id="startDate">
                </div>
                <div class="form-group">
                    <label for="endDate">Data Final:</label>
                    <input type="date" id="endDate">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="applyCustomPeriod">Aplicar</button>
                <button class="btn btn-secondary" id="cancelCustomPeriod">Cancelar</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="customReportModal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3>‚öôÔ∏è Configurar Relat√≥rio Customizado</h3>
                <button class="close-modal" id="closeCustomReport">√ó</button>
            </div>
            <div class="modal-body">
                <div class="report-config-grid">
                    <div class="config-section">
                        <h4>üìä M√©tricas</h4>
                        <div class="metrics-list">
                            <label class="checkbox-item">
                                <input type="checkbox" value="activations" checked>
                                Total de Ativa√ß√µes
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" value="water-usage" checked>
                                Consumo de √Ågua
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" value="costs">
                                Estimativa de Custos
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" value="efficiency">
                                Taxa de Efici√™ncia
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" value="schedules">
                                Agendamentos
                            </label>
                        </div>
                    </div>
                    
                    <div class="config-section">
                        <h4>üìÖ Per√≠odo</h4>
                        <select id="reportPeriod">
                            <option value="last-week">√öltima Semana</option>
                            <option value="last-month">√öltimo M√™s</option>
                            <option value="last-3-months">√öltimos 3 Meses</option>
                            <option value="custom">Personalizado</option>
                        </select>
                    </div>
                    
                    <div class="config-section">
                        <h4>üìà Gr√°ficos</h4>
                        <div class="charts-list">
                            <label class="checkbox-item">
                                <input type="checkbox" value="line-chart" checked>
                                Gr√°fico de Linha
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" value="bar-chart" checked>
                                Gr√°fico de Barras
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" value="pie-chart">
                                Gr√°fico de Pizza
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="generateCustomReport">üìÑ Gerar Relat√≥rio</button>
                <button class="btn btn-secondary" id="cancelCustomReport">Cancelar</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="reportModal">
        <div class="modal-content extra-large">
            <div class="modal-header">
                <h3 id="reportTitle">üìÑ Relat√≥rio</h3>
                <div class="report-actions">
                    <button class="btn btn-small" id="printReport">üñ®Ô∏è Imprimir</button>
                    <button class="btn btn-small" id="downloadPDF">üìÑ PDF</button>
                    <button class="close-modal" id="closeReport">√ó</button>
                </div>
            </div>
            <div class="modal-body">
                <div id="reportContent">
                    <!-- Conte√∫do do relat√≥rio ser√° gerado aqui -->
                </div>
            </div>
        </div>
    </div>


    <!-- Chart.js para os gr√°ficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <!-- Container de Notifica√ß√µes -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Script principal -->
   

</body>
</html>
